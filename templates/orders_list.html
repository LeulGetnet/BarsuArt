{% extends 'base.html'%}
{% load static %}
{% block content %}
<section id="previous-orders" class="container my-5">
    <h2 class="text-center mb-4">{{title}}</h2>
    <div class="row">
        <!-- Order 1 -->
         {%for item in originals%}
        <div class="col-md-4 mb-4 artwork-item" data-index="{{forloop.counter}}">
            <a href="{% url 'detail' item.original.id %}">
            <div class="order-photo position-relative">
                <img src="{{item.latest_image.image.url}}" alt="Order 1" class="img-fluid">
                <div class="description position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center text-white">
                    <p class="text-center">{{item.original.title}}</p>
                </div>

            </div>
        </a>
        </div>
        {%endfor%}
        <!-- Order 2 -->
    </div>
</section>

<script>
// Viewport-aware blur effect - continuously active on scroll
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, starting blur script...');
    
    const artworkItems = document.querySelectorAll('.artwork-item');
    
    console.log('Found artwork items:', artworkItems.length);
    console.log('First item:', artworkItems[0]);
    
    if (artworkItems.length === 0) {
        console.error('No artwork items found!');
        return;
    }
    
    // Check if item is centered and fully visible in viewport
    function isInViewportCenter(element) {
        const rect = element.getBoundingClientRect();
        const windowHeight = window.innerHeight || document.documentElement.clientHeight;
        
        // Calculate visible portion of element
        const elementTop = rect.top;
        const elementBottom = rect.bottom;
        
        // Element is fully in viewport if both top and bottom are within screen bounds
        // Add margin of 50px - items must be at least 50px inside viewport to be clear
        const margin = 50;
        const isFullyVisible = elementTop >= margin && elementBottom <= (windowHeight - margin);
        
        return isFullyVisible;
    }
    
    // Apply blur based on visibility
    function updateBlurEffect() {
        let visibleCount = 0;
        let blurredCount = 0;
        
        artworkItems.forEach((item, index) => {
            const isVisible = isInViewportCenter(item);
            const rect = item.getBoundingClientRect();
            
            if (isVisible) {
                item.classList.remove('blurred');
                item.classList.add('visible');
                visibleCount++;
            } else {
                item.classList.add('blurred');
                item.classList.remove('visible');
                blurredCount++;
            }
        });
        
        console.log('Visible:', visibleCount, 'Blurred:', blurredCount);
    }
    
    // Run immediately
    updateBlurEffect();
    
    // Run on scroll (no throttle for immediate response)
    window.addEventListener('scroll', function() {
        updateBlurEffect();
    }, { passive: true });
    
    // Run on window resize
    window.addEventListener('resize', updateBlurEffect);
    
    console.log('Blur effect initialized and running!');
});
</script>
{% endblock %}